% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cto_fetch_attachment.R
\name{cto_fetch_attachment}
\alias{cto_fetch_attachment}
\title{Download Media Attachments from SurveyCTO}
\usage{
cto_fetch_attachment(
  req,
  form_id,
  private_key = NULL,
  start_date = as.POSIXct("2000-01-01"),
  status = c("approved", "rejected", "pending"),
  path = file.path(getwd(), "media")
)
}
\arguments{
\item{req}{A \code{httr2_request} object initialized via \code{\link{cto_request}()}.}

\item{form_id}{String. The unique ID of the SurveyCTO form.}

\item{private_key}{An optional path to a \code{.pem} private key file. Required
if the form is encrypted.}

\item{start_date}{A \code{POSIXct} object. Only submissions received after
this date/time will be downloaded. Defaults to "2000-01-01".}

\item{status}{A character vector of submission statuses to include.
Options are "approved", "rejected", and "pending". Defaults to all three.}

\item{path}{String The local folder path where media should be saved.
Defaults to a "media" folder in your current working directory.}
}
\value{
Returns \code{NULL} invisibly. Files are written directly to disk.
}
\description{
This function identifies all media-type questions in a SurveyCTO form,
retrieves the associated URLs, and saves the files locally. It is designed
to be efficient: it only downloads files that do not already exist in the
destination folder.
}
\details{
Scans a specified form for media fields (images, audio, video, etc.) and
downloads the files to a local directory.

The function automatically handles:
\itemize{
\item \strong{Deduplication:} Checks if the file already exists locally before downloading.
\item \strong{Resilience:} If a single download fails, the function issues a warning and continues.
\item \strong{Folder Creation:} Automatically creates the destination directory if it doesn't exist.
}
}
\examples{
\dontrun{
# 1. Setup the base request
req <- cto_request("my_server", "user", "pass")

# 2. Download all approved media from a specific form
cto_fetch_attachment(
  req = req,
  form_id = "household_survey_v1",
  path = "downloads/media"
)

# 3. Download encrypted media using a private key
cto_fetch_attachment(
  req = req,
  form_id = "sensitive_health_data",
  private_key = "keys/my_private_key.pem",
  start_date = as.POSIXct("2024-01-01")
)
}
}
\seealso{
\code{\link[=cto_request]{cto_request()}}, \code{\link[=cto_fetch_data]{cto_fetch_data()}}, \code{\link[=cto_form_dataset]{cto_form_dataset()}}
}
