% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cto_get_form.R
\name{cto_get_form}
\alias{cto_get_form}
\title{Download and Parse SurveyCTO Form Definitions}
\usage{
cto_get_form(
  req,
  form_id,
  form_version = NULL,
  file_path = tempfile(fileext = ".xlsx"),
  overwrite = FALSE
)
}
\arguments{
\item{req}{A \code{httr2} request object initialized via
\code{\link{cto_request}()}.}

\item{form_id}{String. The unique ID of the form you wish to retrieve.}

\item{form_version}{Optional numeric. The specific version of the
form to download. If \code{NULL} (the default), the function retrieves the
currently deployed version.}

\item{file_path}{String. The local path where the \code{.xlsx} file will
be saved. Defaults to a temporary file.}

\item{overwrite}{Logical. Should the file at \code{file_path} be overwritten
if it already exists? Defaults to \code{FALSE}.}
}
\value{
A named \code{list} containing three data frames and a vector of form versions:
\itemize{
\item \code{survey}: The main form structure (types, names, labels, etc.).
\item \code{choices}: The multiple-choice options and categories.
\item \code{settings}: Form-level settings including the form title and ID.
\item \code{form_versions}: A vector of available form versions on the server.
}
The list is returned invisibly.
}
\description{
\code{cto_get_form()} retrieves the XLSForm definition of a specified form from
a SurveyCTO server. It allows for downloading the currently deployed version
or a specific previous version, and returns the definition as a list of
data frames (one for each standard XLSForm sheet) and optionally writes to local disc.
}
\details{
The function first queries the SurveyCTO API to list all available files
associated with the \code{form_id}. If a \code{form_version} is specified
but not found, the function provides a helpful error message listing all
valid versions available on the server.

Once downloaded, the \code{.xlsx} file is parsed using \code{openxlsx2}.
The returned list contains the three core XLSForm components required for
understanding form logic and data structure: \code{survey}, \code{choices},
and \code{settings}.
}
\section{Security Note}{

Like all functions in this package, \code{cto_get_form()} utilizes the
provided \code{req} object which stores credentials securely. No sensitive
information is printed to the console during the version check or download
process.
}

\examples{
\dontrun{
# Prepare the request using environment variables
req <- cto_request(auth_file = Sys.getenv("SCTO_AUTH_FILE"))

# Download the latest version of a form
form_def <- cto_get_form(req, form_id = "household_survey")

# View the choices sheet
print(form_def$choices)

# Download a specific historical version
old_def <- cto_get_form(req, "household_survey", form_version = "2201051530")
}
}
\author{
Gutama Girja Urago
}
